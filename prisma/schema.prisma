generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model activity_spots {
  id          String     @id
  name        String
  slug        String?    @unique
  latitude    Float
  longitude   Float
  layer_type  LayerType
  city        String?
  region      String?
  country     String     @default("US")
  spot_type   String?
  tags        String[]
  surface     String?
  skill_level String?
  exposure    String?
  description String?
  seasonality String?
  is_public   Boolean    @default(true)
  source      SpotSource
  source_id   String?
  source_url  String?
  verified    Boolean    @default(false)
  enabled     Boolean    @default(true)
  created_at  DateTime   @default(now())
  updated_at  DateTime

  @@index([layer_type, city])
  @@index([layer_type, latitude, longitude])
  @@index([source, source_id])
}

model import_jobs {
  id                  String    @id
  user_id             String
  list_id             String?
  status              String    @default("processing")
  total_locations     Int?
  processed_locations Int       @default(0)
  failed_locations    Int       @default(0)
  error_log           Json?
  created_at          DateTime  @default(now())
  completed_at        DateTime?
  lists               lists?    @relation(fields: [list_id], references: [id])
  users               users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([user_id])
}

model lists {
  id                    String           @id
  user_id               String
  title                 String
  subtitle              String?
  description           String?
  description_source    String?
  slug                  String           @unique
  intro_text            String?
  function_type         String?
  function_context      String?
  scope_geography       String?
  scope_place_types     String[]
  scope_exclusions      String[]
  organizing_logic      OrganizingLogic?
  organizing_logic_note String?
  notes                 String?
  status                MapStatus        @default(DRAFT)
  published_at          DateTime?
  template_type         String           @default("field-notes")
  cover_image_url       String?
  primary_color         String           @default("#5BA7A7")
  secondary_color       String           @default("#7FA5A5")
  access_level          String           @default("public")
  password_hash         String?
  allowed_emails        String[]
  published             Boolean          @default(false)
  view_count            Int              @default(0)
  created_at            DateTime         @default(now())
  updated_at            DateTime
  import_jobs           import_jobs[]
  users                 users            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  locations             locations[]
  map_places            map_places[]

  @@index([published])
  @@index([slug])
  @@index([status])
  @@index([user_id])
}

model locations {
  id                    String    @id
  list_id               String
  google_place_id       String?
  name                  String
  address               String?
  latitude              Decimal?  @db.Decimal(10, 8)
  longitude             Decimal?  @db.Decimal(11, 8)
  phone                 String?
  website               String?
  instagram             String?
  hours                 Json?
  description           String?
  google_types          String[]  @default([])
  price_level           Int?
  neighborhood          String?
  google_photos         Json?
  user_photos           String[]
  user_note             String?
  category              String?
  descriptor            String?
  order_index           Int       @default(0)
  places_data_cached_at DateTime?
  created_at            DateTime  @default(now())
  updated_at            DateTime
  lists                 lists     @relation(fields: [list_id], references: [id], onDelete: Cascade)

  @@index([google_place_id])
  @@index([list_id, category])
  @@index([list_id])
  @@index([list_id, order_index])
}

model map_places {
  id          String   @id
  map_id      String
  place_id    String
  descriptor  String?  @db.VarChar(120)
  user_note   String?
  user_photos String[]
  order_index Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime
  lists       lists    @relation(fields: [map_id], references: [id], onDelete: Cascade)
  places      places   @relation(fields: [place_id], references: [id])

  @@unique([map_id, place_id])
  @@index([map_id])
  @@index([map_id, order_index])
  @@index([place_id])
}

model people {
  id                  String             @id
  name                String
  slug                String             @unique
  role                PersonRole
  visibility          Visibility
  bio                 String?
  image_url           String?
  sources             Json
  restaurant_group_id String?
  created_at          DateTime           @default(now())
  updated_at          DateTime
  restaurant_groups   restaurant_groups? @relation(fields: [restaurant_group_id], references: [id])
  person_places       person_places[]

  @@index([restaurant_group_id])
  @@index([slug])
  @@index([visibility])
}

model person_places {
  id         String          @id
  person_id  String
  place_id   String
  role       PersonPlaceRole
  current    Boolean         @default(true)
  start_year Int?
  end_year   Int?
  source     String
  created_at DateTime        @default(now())
  updated_at DateTime
  people     people          @relation(fields: [person_id], references: [id], onDelete: Cascade)
  places     places          @relation(fields: [place_id], references: [id], onDelete: Cascade)

  @@unique([person_id, place_id, role])
  @@index([current])
  @@index([person_id])
  @@index([place_id])
}

model places {
  id                      String             @id
  slug                    String             @unique
  google_place_id         String?            @unique
  name                    String
  address                 String?
  latitude                Decimal?           @db.Decimal(10, 8)
  longitude               Decimal?           @db.Decimal(11, 8)
  phone                   String?
  website                 String?
  instagram               String?
  hours                   Json?
  description             String?
  google_photos           Json?
  google_types            String[]           @default([])
  price_level             Int?
  neighborhood            String?
  category                String?
  places_data_cached_at   DateTime?
  created_at              DateTime           @default(now())
  updated_at              DateTime
  editorial_sources       Json?
  cuisine_type            String?
  ad_unit_override        Boolean            @default(false)
  ad_unit_type            String?
  pull_quote              String?
  pull_quote_author       String?
  pull_quote_source       String?
  pull_quote_type         String?
  pull_quote_url          String?
  tagline                 String?
  tagline_candidates      String[]           @default([])
  tagline_generated       DateTime?
  tagline_pattern         String?
  tagline_signals         Json?
  tips                    String[]           @default([])
  vibe_tags               String[]           @default([])
  chef_recs               Json?
  restaurant_group_id     String?
  status                  PlaceStatus        @default(OPEN)
  intent_profile          String?
  intent_profile_override Boolean            @default(false)
  reservation_url         String?
  map_places              map_places[]
  person_places           person_places[]
  restaurant_groups       restaurant_groups? @relation(fields: [restaurant_group_id], references: [id])
  viewer_bookmarks        viewer_bookmarks[]

  @@index([category])
  @@index([google_place_id])
  @@index([neighborhood])
  @@index([restaurant_group_id])
  @@index([status])
}

model restaurant_groups {
  id                      String     @id
  name                    String
  slug                    String     @unique
  visibility              Visibility
  description             String?
  anchor_city             String?
  website                 String?
  location_count_estimate Int?
  sources                 Json
  created_at              DateTime   @default(now())
  updated_at              DateTime
  people                  people[]
  places                  places[]

  @@index([slug])
  @@index([visibility])
}

model users {
  id                String             @id
  email             String             @unique
  name              String?
  password_hash     String?
  avatar_url        String?
  subscription_tier String             @default("free")
  created_at        DateTime           @default(now())
  updated_at        DateTime
  import_jobs       import_jobs[]
  lists             lists[]
  viewer_bookmarks  viewer_bookmarks[]

  @@index([email])
}

model viewer_bookmarks {
  id             String   @id
  viewer_user_id String?
  place_id       String
  visited        Boolean  @default(false)
  personal_note  String?
  created_at     DateTime @default(now())
  updated_at     DateTime
  places         places   @relation(fields: [place_id], references: [id], onDelete: Cascade)
  users          users?   @relation(fields: [viewer_user_id], references: [id], onDelete: Cascade)

  @@unique([viewer_user_id, place_id])
  @@index([place_id])
  @@index([viewer_user_id])
}

enum LayerType {
  SKATE
  SURF
}

enum MapStatus {
  DRAFT
  READY
  PUBLISHED
  ARCHIVED
}

enum OrganizingLogic {
  TIME_BASED
  NEIGHBORHOOD_BASED
  ROUTE_BASED
  PURPOSE_BASED
  LAYERED
}

enum PersonPlaceRole {
  EXECUTIVE_CHEF
  OWNER
  FOUNDER
  FORMER_CHEF
  PARTNER
  OPERATOR
}

enum PersonRole {
  CHEF
  OWNER
  OPERATOR
  FOUNDER
  PARTNER
}

enum PlaceStatus {
  OPEN
  CLOSED
  PERMANENTLY_CLOSED
}

enum SpotSource {
  OSM
  CITY_DATA
  EDITORIAL
  COMMUNITY
}

enum Visibility {
  INTERNAL
  VERIFIED
}
