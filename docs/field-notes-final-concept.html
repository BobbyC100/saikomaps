<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saiko Maps — Field Notes · Final Pin Concept</title>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background-color: #0a0a0a;
      padding: 40px 40px 120px;
      min-height: 100vh;
      color: #ccc;
    }

    .page-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .page-title {
      color: #444;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 4px;
      margin-bottom: 12px;
    }

    .page-subtitle {
      color: #C3B091;
      font-family: 'Libre Baskerville', Georgia, serif;
      font-size: 18px;
      font-style: italic;
      margin-bottom: 8px;
    }

    .page-desc {
      color: #555;
      font-size: 12px;
      max-width: 480px;
      margin: 0 auto;
      line-height: 1.7;
    }

    .concepts {
      display: flex;
      flex-direction: column;
      gap: 80px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .concept-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .concept-label {
      color: #C3B091;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    .concept-desc {
      color: #777;
      font-size: 13px;
      line-height: 1.7;
      max-width: 560px;
    }

    .concept-desc code {
      background: rgba(195,176,145,0.1);
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 11px;
      color: #C3B091;
    }

    .hint {
      color: #555;
      font-size: 10px;
      font-style: italic;
      margin-top: 4px;
    }


    /* ================================================================
       MAP CANVAS
       ================================================================ */
    .map-canvas {
      width: 100%;
      max-width: 720px;
      height: 520px;
      border-radius: 14px;
      position: relative;
      overflow: hidden;
      cursor: default;
    }

    .map-bg-light {
      background: linear-gradient(145deg, #EDE8D8 0%, #F0ECE2 40%, #E8E2D4 70%, #E6E0D4 100%);
    }

    .map-bg-dark {
      background: linear-gradient(145deg, #152030 0%, #1A2D42 40%, #1E3148 70%, #1B2A3D 100%);
    }

    /* Subtle grid */
    .map-grid {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image:
        linear-gradient(90deg, rgba(195,176,145,0.07) 1px, transparent 1px),
        linear-gradient(rgba(195,176,145,0.07) 1px, transparent 1px);
      background-size: 48px 48px;
    }
    .map-bg-dark .map-grid {
      background-image:
        linear-gradient(90deg, rgba(137,180,196,0.04) 1px, transparent 1px),
        linear-gradient(rgba(137,180,196,0.04) 1px, transparent 1px);
    }

    /* Roads */
    .map-road {
      position: absolute;
      background: rgba(195,176,145,0.15);
    }
    .map-bg-dark .map-road {
      background: rgba(137,180,196,0.07);
    }

    .road-h1 { top: 168px; left: 0; right: 0; height: 2.5px; background: rgba(195,176,145,0.2); }
    .road-h2 { top: 295px; left: 0; right: 0; height: 1.5px; }
    .road-h3 { top: 400px; left: 0; right: 0; height: 1.5px; }
    .road-v1 { top: 0; bottom: 0; left: 210px; width: 2.5px; background: rgba(195,176,145,0.2); }
    .road-v2 { top: 0; bottom: 0; left: 420px; width: 1.5px; }
    .road-v3 { top: 0; bottom: 0; left: 560px; width: 1px; }
    .road-d1 { top: 0; left: 50px; width: 600px; height: 1px; transform: rotate(18deg); transform-origin: top left; }
    .road-d2 { top: 80px; left: 350px; width: 400px; height: 1px; transform: rotate(-14deg); transform-origin: top left; }
    .road-d3 { top: 200px; left: 0; width: 500px; height: 1px; transform: rotate(28deg); transform-origin: top left; }

    .map-bg-dark .road-h1 { background: rgba(137,180,196,0.09); }
    .map-bg-dark .road-v1 { background: rgba(137,180,196,0.09); }

    /* Water body hint — left edge */
    .water-wash {
      position: absolute;
      top: 0; left: 0; bottom: 0;
      width: 80px;
      background: linear-gradient(90deg, rgba(137,180,196,0.08) 0%, transparent 100%);
      pointer-events: none;
    }
    .map-bg-dark .water-wash {
      background: linear-gradient(90deg, rgba(137,180,196,0.05) 0%, transparent 100%);
    }

    /* Neighborhood labels */
    .area-label {
      position: absolute;
      font-size: 8px;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: rgba(195,176,145,0.3);
      pointer-events: none;
      font-weight: 600;
    }
    .map-bg-dark .area-label {
      color: rgba(137,180,196,0.15);
    }

    /* Mode badge */
    .mode-badge {
      position: absolute;
      top: 14px;
      left: 16px;
      font-size: 8px;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(195,176,145,0.4);
      z-index: 2;
      pointer-events: none;
    }
    .map-bg-dark .mode-badge {
      color: rgba(137,180,196,0.25);
    }


    /* ================================================================
       STACKED PINS — Style 3
       ================================================================ */
    .stacked-pin {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      z-index: 4;
      cursor: pointer;
      transition: z-index 0s;
    }

    .stacked-pin .pin-dot {
      width: 14px;
      height: 14px;
      background: #D64541;
      border-radius: 50%;
      border: 2.5px solid #F5F0E1;
      box-shadow: 0 2px 8px rgba(214,69,65,0.35);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .stacked-pin:hover .pin-dot {
      transform: scale(1.15);
      box-shadow: 0 3px 12px rgba(214,69,65,0.45);
    }

    .stacked-pin .stacked-label {
      font-family: 'Libre Baskerville', Georgia, serif;
      font-size: 8px;
      font-style: italic;
      color: #36454F;
      opacity: 0.5;
      white-space: nowrap;
      text-align: center;
      text-shadow:
        0 0 6px rgba(245,240,225,0.95),
        0 0 12px rgba(245,240,225,0.6);
      max-width: 80px;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: opacity 0.2s ease;
    }

    .stacked-pin:hover .stacked-label {
      opacity: 0.75;
    }

    .stacked-pin.featured .pin-dot {
      width: 18px;
      height: 18px;
      box-shadow: 0 2px 10px rgba(214,69,65,0.4);
    }

    .stacked-pin.featured .stacked-label {
      font-size: 10px;
      opacity: 0.7;
      font-weight: 700;
      max-width: 100px;
    }

    .stacked-pin.featured:hover .stacked-label {
      opacity: 0.9;
    }

    /* Active state — when popup is showing */
    .stacked-pin.active {
      z-index: 15;
    }

    .stacked-pin.active .pin-dot {
      transform: scale(1.2);
      box-shadow: 0 0 0 4px rgba(214,69,65,0.15), 0 3px 12px rgba(214,69,65,0.45);
    }

    .stacked-pin.active .stacked-label {
      opacity: 0.9;
    }

    /* Ghost pins — unlabeled background dots */
    .stacked-pin.ghost .pin-dot {
      width: 10px;
      height: 10px;
      opacity: 0.35;
      border-width: 2px;
    }
    .stacked-pin.ghost .stacked-label { display: none; }

    /* Dark mode pins */
    .map-bg-dark .stacked-pin .pin-dot {
      border-color: #1B2A3D;
    }
    .map-bg-dark .stacked-pin .stacked-label {
      color: rgba(245,240,225,0.45);
      text-shadow:
        0 0 6px rgba(27,42,61,0.95),
        0 0 12px rgba(27,42,61,0.6);
    }
    .map-bg-dark .stacked-pin:hover .stacked-label {
      color: rgba(245,240,225,0.65);
    }
    .map-bg-dark .stacked-pin.featured .stacked-label {
      color: rgba(245,240,225,0.6);
    }
    .map-bg-dark .stacked-pin.featured:hover .stacked-label {
      color: rgba(245,240,225,0.8);
    }
    .map-bg-dark .stacked-pin.active .stacked-label {
      color: rgba(245,240,225,0.85);
    }
    .map-bg-dark .stacked-pin.active .pin-dot {
      box-shadow: 0 0 0 4px rgba(214,69,65,0.2), 0 3px 12px rgba(214,69,65,0.5);
    }


    /* ================================================================
       BENTO POPUP CARD
       ================================================================ */
    .popup-bento {
      position: absolute;
      width: 310px;
      background: #FFFDF7;
      border-radius: 12px;
      box-shadow:
        0 2px 8px rgba(139,115,85,0.08),
        0 16px 48px rgba(139,115,85,0.14);
      overflow: hidden;
      z-index: 25;
      display: grid;
      grid-template-columns: 115px 1fr;
      grid-template-rows: 1fr auto;

      /* Entry animation */
      opacity: 0;
      transform: translateY(8px) scale(0.97);
      animation: popupEnter 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes popupEnter {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .popup-bento .bento-photo {
      grid-row: 1 / 3;
      background-size: cover;
      background-position: center;
      filter: saturate(0.88) contrast(1.05);
      min-height: 170px;
      position: relative;
    }

    .popup-bento .bento-info {
      padding: 16px 16px 10px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .popup-bento .bento-name {
      font-family: 'Libre Baskerville', Georgia, serif;
      font-size: 16px;
      font-style: italic;
      color: #36454F;
      line-height: 1.25;
    }

    .popup-bento .bento-meta {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #C3B091;
      margin-top: 2px;
    }

    .popup-bento .bento-status {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 6px;
    }

    .popup-bento .bento-status .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #4A7C59;
    }

    .popup-bento .bento-status span {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #4A7C59;
      font-weight: 600;
    }

    .popup-bento .bento-status.closed .dot { background: #36454F; opacity: 0.4; }
    .popup-bento .bento-status.closed span { color: #36454F; opacity: 0.4; }

    .popup-bento .bento-actions {
      padding: 0 16px 14px;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .popup-bento .bento-btn {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .popup-bento .btn-primary {
      background: #36454F;
      color: #F5F0E1;
    }
    .popup-bento .btn-primary:hover { background: #2a363e; }

    .popup-bento .btn-secondary {
      background: rgba(195,176,145,0.15);
      color: #8B7355;
    }
    .popup-bento .btn-secondary:hover { background: rgba(195,176,145,0.28); }

    /* Merchant page link — bottom bar */
    .popup-bento .bento-merchant-link {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px;
      background: rgba(195,176,145,0.08);
      border-top: 1px solid rgba(195,176,145,0.15);
      font-family: 'Libre Baskerville', Georgia, serif;
      font-size: 10px;
      font-style: italic;
      color: #8B7355;
      cursor: pointer;
      transition: background 0.2s ease;
      text-decoration: none;
    }
    .popup-bento .bento-merchant-link:hover {
      background: rgba(195,176,145,0.18);
    }
    .popup-bento .bento-merchant-link svg {
      width: 11px;
      height: 11px;
      flex-shrink: 0;
    }

    /* Notch arrow pointing down to pin */
    .popup-bento .notch {
      position: absolute;
      bottom: -7px;
      width: 14px;
      height: 14px;
      background: rgba(195,176,145,0.08);
      transform: rotate(45deg);
      box-shadow: 3px 3px 6px rgba(139,115,85,0.06);
    }

    /* ---- Dark mode ---- */
    .popup-bento.dark {
      background: rgba(30, 47, 68, 0.96);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(137,180,196,0.1);
      box-shadow:
        0 4px 16px rgba(0,0,0,0.3),
        0 0 0 1px rgba(137,180,196,0.05);
    }
    .popup-bento.dark .bento-name { color: #F5F0E1; }
    .popup-bento.dark .bento-meta { color: rgba(137,180,196,0.5); }
    .popup-bento.dark .bento-status .dot { background: #6BBF8A; }
    .popup-bento.dark .bento-status span { color: #6BBF8A; }
    .popup-bento.dark .bento-status.closed .dot { background: rgba(137,180,196,0.3); }
    .popup-bento.dark .bento-status.closed span { color: rgba(137,180,196,0.3); }
    .popup-bento.dark .btn-primary { background: #F5F0E1; color: #1B2A3D; }
    .popup-bento.dark .btn-primary:hover { background: #ebe5d4; }
    .popup-bento.dark .btn-secondary { background: rgba(137,180,196,0.1); color: rgba(137,180,196,0.6); }
    .popup-bento.dark .btn-secondary:hover { background: rgba(137,180,196,0.18); }
    .popup-bento.dark .bento-merchant-link {
      background: rgba(137,180,196,0.05);
      border-top-color: rgba(137,180,196,0.08);
      color: rgba(137,180,196,0.5);
    }
    .popup-bento.dark .bento-merchant-link:hover {
      background: rgba(137,180,196,0.12);
      color: #89B4C4;
    }
    .popup-bento.dark .notch {
      background: rgba(137,180,196,0.05);
      box-shadow: 3px 3px 6px rgba(0,0,0,0.15);
    }
    .popup-bento.dark .bento-photo {
      filter: saturate(0.8) contrast(1.08) brightness(0.9);
    }

    /* Hidden state for JS toggling */
    .popup-bento.hidden {
      display: none;
    }


    /* ================================================================
       TOP BAR — simulated nav overlay
       ================================================================ */
    .map-topbar {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 30;
      pointer-events: none;
      background: linear-gradient(180deg, rgba(245,240,225,0.6) 0%, transparent 100%);
    }
    .map-bg-dark .map-topbar {
      background: linear-gradient(180deg, rgba(21,32,48,0.6) 0%, transparent 100%);
    }

    .map-topbar .saiko-wordmark {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: #C3B091;
      opacity: 0.6;
    }
    .map-bg-dark .map-topbar .saiko-wordmark {
      color: rgba(137,180,196,0.4);
    }

    .map-topbar .map-title {
      font-family: 'Libre Baskerville', Georgia, serif;
      font-size: 13px;
      font-style: italic;
      color: #36454F;
      opacity: 0.7;
    }
    .map-bg-dark .map-topbar .map-title {
      color: rgba(245,240,225,0.5);
    }


    /* ================================================================
       BOTTOM SCALE BAR
       ================================================================ */
    .map-scale {
      position: absolute;
      bottom: 16px;
      left: 20px;
      display: flex;
      align-items: flex-end;
      gap: 5px;
      z-index: 3;
      pointer-events: none;
    }

    .map-scale .bar {
      width: 60px;
      height: 2px;
      background: rgba(139,115,85,0.25);
      position: relative;
    }
    .map-scale .bar::before,
    .map-scale .bar::after {
      content: '';
      position: absolute;
      width: 1px;
      height: 6px;
      background: rgba(139,115,85,0.25);
      bottom: 0;
    }
    .map-scale .bar::before { left: 0; }
    .map-scale .bar::after { right: 0; }

    .map-scale span {
      font-family: 'Courier New', monospace;
      font-size: 7px;
      color: rgba(139,115,85,0.35);
      letter-spacing: 1px;
    }

    .map-bg-dark .map-scale .bar { background: rgba(137,180,196,0.15); }
    .map-bg-dark .map-scale .bar::before,
    .map-bg-dark .map-scale .bar::after { background: rgba(137,180,196,0.15); }
    .map-bg-dark .map-scale span { color: rgba(137,180,196,0.2); }

    /* Compass */
    .map-compass {
      position: absolute;
      bottom: 16px;
      right: 20px;
      width: 28px;
      height: 28px;
      z-index: 3;
      pointer-events: none;
      opacity: 0.25;
    }
    .map-bg-dark .map-compass { opacity: 0.15; }
  </style>
</head>
<body>

  <div class="page-header">
    <div class="page-title">Saiko Maps — Field Notes Template</div>
    <div class="page-subtitle">Final Pin & Popup Concept</div>
    <p class="page-desc">
      Stacked label pins + Bento Card popup. Click any pin to see the
      popup. Click the map background to dismiss.
    </p>
  </div>

  <div class="concepts">

    <!-- ============================================================
         LIGHT MODE — FULL CONTEXT
         ============================================================ -->
    <div class="concept-section">
      <div class="concept-label">Light Mode — Interactive</div>
      <p class="concept-desc">
        Stacked pins with Libre Baskerville italic labels centered below each marker.
        Featured pins are larger and bolder. Tapping a pin opens the Bento Card popup
        with photo, info, actions, and a <code>/place/[slug]</code> merchant link footer.
      </p>
      <p class="hint">Click any pin · click background to dismiss</p>

      <div class="map-canvas map-bg-light" id="map-light">
        <!-- Topbar -->
        <div class="map-topbar">
          <span class="saiko-wordmark">Saiko Maps</span>
          <span class="map-title">Silver Lake Natural Wine</span>
        </div>

        <!-- Grid + Roads -->
        <div class="map-grid"></div>
        <div class="water-wash"></div>
        <div class="map-road road-h1"></div>
        <div class="map-road road-h2"></div>
        <div class="map-road road-h3"></div>
        <div class="map-road road-v1"></div>
        <div class="map-road road-v2"></div>
        <div class="map-road road-v3"></div>
        <div class="map-road road-d1"></div>
        <div class="map-road road-d2"></div>
        <div class="map-road road-d3"></div>

        <!-- Neighborhood labels -->
        <span class="area-label" style="top: 72px; left: 100px;">Silver Lake</span>
        <span class="area-label" style="top: 340px; left: 440px;">Echo Park</span>

        <!-- ---- STACKED PINS ---- -->
        <div class="stacked-pin featured active" style="top: 100px; left: 260px;"
             data-map="light"
             data-name="Seco"
             data-meta="Wine Bar · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Seco</span>
        </div>

        <div class="stacked-pin" style="top: 155px; left: 395px;"
             data-map="light"
             data-name="Bar Covell"
             data-meta="Wine Bar · Los Feliz"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Bar Covell</span>
        </div>

        <div class="stacked-pin featured" style="top: 230px; left: 300px;"
             data-map="light"
             data-name="Vinovore"
             data-meta="Wine Shop · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1552566626-52f8b828add9?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Vinovore</span>
        </div>

        <div class="stacked-pin" style="top: 185px; left: 520px;"
             data-map="light"
             data-name="1642"
             data-meta="Wine Bar · Echo Park"
             data-status="Closed"
             data-photo="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">1642</span>
        </div>

        <div class="stacked-pin" style="top: 320px; left: 195px;"
             data-map="light"
             data-name="Psychic Wines"
             data-meta="Wine Shop · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1466978913421-dad2ebd01d17?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Psychic Wines</span>
        </div>

        <div class="stacked-pin" style="top: 280px; left: 480px;"
             data-map="light"
             data-name="Tilda"
             data-meta="Wine Bar · Echo Park"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Tilda</span>
        </div>

        <div class="stacked-pin" style="top: 390px; left: 350px;"
             data-map="light"
             data-name="Helen's"
             data-meta="Wine Bar · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Helen's</span>
        </div>

        <!-- Ghost pins for density -->
        <div class="stacked-pin ghost" style="top: 175px; left: 130px;">
          <div class="pin-dot"></div>
        </div>
        <div class="stacked-pin ghost" style="top: 430px; left: 560px;">
          <div class="pin-dot"></div>
        </div>
        <div class="stacked-pin ghost" style="top: 360px; left: 620px;">
          <div class="pin-dot"></div>
        </div>

        <!-- Default visible popup for Seco -->
        <div class="popup-bento" id="popup-light" style="top: -118px; left: 105px;" data-map="light">
          <div class="bento-photo" style="background-image: url('https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=300&h=400&fit=crop');"></div>
          <div class="bento-info">
            <div class="bento-name">Seco</div>
            <div class="bento-meta">Wine Bar · Silver Lake</div>
            <div class="bento-status">
              <div class="dot"></div>
              <span>Open</span>
            </div>
          </div>
          <div class="bento-actions">
            <button class="bento-btn btn-primary">Directions</button>
            <button class="bento-btn btn-secondary">Share</button>
          </div>
          <a class="bento-merchant-link" href="#">
            View full profile
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
          </a>
          <div class="notch" style="left: 155px;"></div>
        </div>

        <!-- Scale + Compass -->
        <div class="map-scale">
          <div class="bar"></div>
          <span>1 MI</span>
        </div>
        <div class="map-compass">
          <svg viewBox="0 0 40 40" fill="none">
            <line x1="20" y1="4" x2="20" y2="36" stroke="#8B7355" stroke-width="1"/>
            <line x1="4" y1="20" x2="36" y2="20" stroke="#8B7355" stroke-width="1"/>
            <polygon points="20,4 22,12 18,12" fill="#8B7355"/>
            <text x="20" y="3" text-anchor="middle" font-size="5" fill="#8B7355" font-family="Courier New">N</text>
          </svg>
        </div>
      </div>
    </div>


    <!-- ============================================================
         DARK MODE — FULL CONTEXT
         ============================================================ -->
    <div class="concept-section">
      <div class="concept-label">Dark Mode — Interactive</div>
      <p class="concept-desc">
        Same system, dark palette. Glassmorphism backdrop-filter on the popup,
        muted photo treatment, ocean-blue accent text. Pin borders blend into
        the dark map surface.
      </p>
      <p class="hint">Click any pin · click background to dismiss</p>

      <div class="map-canvas map-bg-dark" id="map-dark">
        <!-- Topbar -->
        <div class="map-topbar">
          <span class="saiko-wordmark">Saiko Maps</span>
          <span class="map-title">Silver Lake Natural Wine</span>
        </div>

        <!-- Grid + Roads -->
        <div class="map-grid"></div>
        <div class="water-wash"></div>
        <div class="map-road road-h1"></div>
        <div class="map-road road-h2"></div>
        <div class="map-road road-h3"></div>
        <div class="map-road road-v1"></div>
        <div class="map-road road-v2"></div>
        <div class="map-road road-v3"></div>
        <div class="map-road road-d1"></div>
        <div class="map-road road-d2"></div>
        <div class="map-road road-d3"></div>

        <!-- Neighborhood labels -->
        <span class="area-label" style="top: 72px; left: 100px;">Silver Lake</span>
        <span class="area-label" style="top: 340px; left: 440px;">Echo Park</span>

        <!-- ---- STACKED PINS ---- -->
        <div class="stacked-pin featured" style="top: 100px; left: 260px;"
             data-map="dark"
             data-name="Seco"
             data-meta="Wine Bar · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Seco</span>
        </div>

        <div class="stacked-pin" style="top: 155px; left: 395px;"
             data-map="dark"
             data-name="Bar Covell"
             data-meta="Wine Bar · Los Feliz"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Bar Covell</span>
        </div>

        <div class="stacked-pin featured" style="top: 230px; left: 300px;"
             data-map="dark"
             data-name="Vinovore"
             data-meta="Wine Shop · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1552566626-52f8b828add9?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Vinovore</span>
        </div>

        <div class="stacked-pin" style="top: 185px; left: 520px;"
             data-map="dark"
             data-name="1642"
             data-meta="Wine Bar · Echo Park"
             data-status="Closed"
             data-photo="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">1642</span>
        </div>

        <div class="stacked-pin" style="top: 320px; left: 195px;"
             data-map="dark"
             data-name="Psychic Wines"
             data-meta="Wine Shop · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1466978913421-dad2ebd01d17?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Psychic Wines</span>
        </div>

        <div class="stacked-pin" style="top: 280px; left: 480px;"
             data-map="dark"
             data-name="Tilda"
             data-meta="Wine Bar · Echo Park"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Tilda</span>
        </div>

        <div class="stacked-pin" style="top: 390px; left: 350px;"
             data-map="dark"
             data-name="Helen's"
             data-meta="Wine Bar · Silver Lake"
             data-status="Open"
             data-photo="https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=300&h=400&fit=crop">
          <div class="pin-dot"></div>
          <span class="stacked-label">Helen's</span>
        </div>

        <!-- Ghost pins -->
        <div class="stacked-pin ghost" style="top: 175px; left: 130px;">
          <div class="pin-dot"></div>
        </div>
        <div class="stacked-pin ghost" style="top: 430px; left: 560px;">
          <div class="pin-dot"></div>
        </div>
        <div class="stacked-pin ghost" style="top: 360px; left: 620px;">
          <div class="pin-dot"></div>
        </div>

        <!-- Popup (starts hidden) -->
        <div class="popup-bento dark hidden" id="popup-dark" data-map="dark">
          <div class="bento-photo"></div>
          <div class="bento-info">
            <div class="bento-name"></div>
            <div class="bento-meta"></div>
            <div class="bento-status">
              <div class="dot"></div>
              <span></span>
            </div>
          </div>
          <div class="bento-actions">
            <button class="bento-btn btn-primary">Directions</button>
            <button class="bento-btn btn-secondary">Share</button>
          </div>
          <a class="bento-merchant-link" href="#">
            View full profile
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
          </a>
          <div class="notch"></div>
        </div>

        <!-- Scale + Compass -->
        <div class="map-scale">
          <div class="bar"></div>
          <span>1 MI</span>
        </div>
        <div class="map-compass">
          <svg viewBox="0 0 40 40" fill="none">
            <line x1="20" y1="4" x2="20" y2="36" stroke="#89B4C4" stroke-width="1"/>
            <line x1="4" y1="20" x2="36" y2="20" stroke="#89B4C4" stroke-width="1"/>
            <polygon points="20,4 22,12 18,12" fill="#89B4C4"/>
            <text x="20" y="3" text-anchor="middle" font-size="5" fill="#89B4C4" font-family="Courier New">N</text>
          </svg>
        </div>
      </div>
    </div>

  </div>


  <script>
    // ================================================================
    // Interactive pin ↔ popup logic
    // ================================================================

    const POPUP_WIDTH = 310;
    const POPUP_HEIGHT = 230; // approximate

    function showPopup(pin) {
      const mapId = pin.dataset.map;
      const mapEl = document.getElementById('map-' + mapId);
      const popupEl = document.getElementById('popup-' + mapId);
      const isDark = mapId === 'dark';

      // Clear all active states in this map
      mapEl.querySelectorAll('.stacked-pin.active').forEach(p => p.classList.remove('active'));
      pin.classList.add('active');

      // Populate popup
      popupEl.querySelector('.bento-name').textContent = pin.dataset.name;
      popupEl.querySelector('.bento-meta').textContent = pin.dataset.meta;
      popupEl.querySelector('.bento-photo').style.backgroundImage = `url('${pin.dataset.photo}')`;

      const statusEl = popupEl.querySelector('.bento-status');
      const statusText = popupEl.querySelector('.bento-status span');
      statusText.textContent = pin.dataset.status;
      if (pin.dataset.status === 'Closed') {
        statusEl.classList.add('closed');
      } else {
        statusEl.classList.remove('closed');
      }

      // Position popup above the pin
      const pinRect = pin.getBoundingClientRect();
      const mapRect = mapEl.getBoundingClientRect();
      const pinX = pinRect.left - mapRect.left + pinRect.width / 2;
      const pinY = pinRect.top - mapRect.top;

      let popupLeft = pinX - POPUP_WIDTH / 2;
      const popupTop = pinY - POPUP_HEIGHT - 14;

      // Clamp horizontal position within map bounds
      const margin = 12;
      if (popupLeft < margin) popupLeft = margin;
      if (popupLeft + POPUP_WIDTH > mapRect.width - margin) {
        popupLeft = mapRect.width - POPUP_WIDTH - margin;
      }

      popupEl.style.top = popupTop + 'px';
      popupEl.style.left = popupLeft + 'px';

      // Position the notch arrow to point at the pin center
      const notchEl = popupEl.querySelector('.notch');
      const notchPos = pinX - popupLeft - 7; // 7 = half notch width
      notchEl.style.left = Math.max(16, Math.min(notchPos, POPUP_WIDTH - 28)) + 'px';

      // Show with re-triggered animation
      popupEl.classList.remove('hidden');
      popupEl.style.animation = 'none';
      popupEl.offsetHeight; // force reflow
      popupEl.style.animation = '';
    }

    function hidePopup(mapId) {
      const mapEl = document.getElementById('map-' + mapId);
      const popupEl = document.getElementById('popup-' + mapId);
      popupEl.classList.add('hidden');
      mapEl.querySelectorAll('.stacked-pin.active').forEach(p => p.classList.remove('active'));
    }

    // Bind pin clicks
    document.querySelectorAll('.stacked-pin[data-name]').forEach(pin => {
      pin.addEventListener('click', (e) => {
        e.stopPropagation();
        showPopup(pin);
      });
    });

    // Bind map background click to dismiss
    document.querySelectorAll('.map-canvas').forEach(map => {
      map.addEventListener('click', (e) => {
        // Only dismiss if clicking the map background itself
        if (e.target.closest('.stacked-pin') || e.target.closest('.popup-bento')) return;
        const mapId = map.id.replace('map-', '');
        hidePopup(mapId);
      });
    });

    // Prevent popup clicks from propagating
    document.querySelectorAll('.popup-bento').forEach(popup => {
      popup.addEventListener('click', (e) => e.stopPropagation());
    });

    // Show the initial light mode popup on load (Seco)
    window.addEventListener('DOMContentLoaded', () => {
      const secoPin = document.querySelector('#map-light .stacked-pin.featured.active');
      if (secoPin) {
        // Small delay for layout to settle
        setTimeout(() => showPopup(secoPin), 100);
      }
    });
  </script>

</body>
</html>
